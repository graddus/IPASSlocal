<!DOCTYPE html>
<html>
<head>
<title>My Completed List</title>
<link rel="stylesheet" href="css/mycompleted.css">
</head>
<body>

<ul id="header">
  <li><a class="active" href="agenda.html">View Agenda</a></li>
   <li><a href="series.html">Browse Airing Series</a></li>
  <li><a href="mylist.html">View Subscribed Series</a></li>
   <li><a href="email.html">Manage E-mail Notifications</a></li>
   <li style="float:right"><a class="active" href="logout.html">Logout</a></li>
</ul>
<div id="seriesList">
 <h1>My Completed List</h1>
 <table id="series">
 <tr>
 	<th>Series&emsp;</th>
    <th>Title&emsp;</th>
    <th>Genre&emsp;</th>
    <th>Episodes&emsp;</th> 
    <th>Rating&emsp;</th>
    <th>Viewers&emsp;</th>
    <th>Synopsis&emsp;</th>
    <th>My Rating&emsp;</th>
  </tr>
 </table>
 </div>
<script src="https://code.jquery.com/jquery-3.2.0.min.js"></script>
<script>
function loadSeries(){
	var user=window.sessionStorage.getItem("user");
	var password=window.sessionStorage.getItem("password");
		$.getJSON("/restservices/customerseries/"+user+"+"+password+"/finished", function(data){
			$.each(data, function(i, series){
				$("#series").append(
				"<tr><td><center><img src=img/"+series.id+".jpg border=3 style=width:30%;></img></center>&emsp;<br></td>"
				+"<td><b>"+series.title+"</b>&emsp;<br></td>"
				+"<td>"+series.genre+"&emsp;<br></td>"
				+"<td>"+series.episodes+"&emsp;<br></td>"
				+"<td>"+series.score+"&emsp;<br></td>"
				+"<td>"+series.viewers+"&emsp;<br></td>"
				+"<td style=font-size:15px;>"+series.synopsis+"&emsp;<br></td>"
				+"<td><form id=updateScore>"
				 +"<input type=text value="+series.myscore+" id=score"+series.id+" />"
				+"<input type=button data-custid="+user+" data-seriesid="+series.id+" id=update value=Update /></form></td></tr>");
			});
	});
}
</script>
<script>
$("#series").on('click', 'input[type=button]', function () {
	var user=window.sessionStorage.getItem("user");
	var password=window.sessionStorage.getItem("password");
    var custid = $(this).data('custid');
    var seriesid = $(this).data('seriesid');
    var score=$('#score'+seriesid).val();
    var intscore=parseInt(score);
    if (intscore>0 && intscore<11){
	
	var uri = "/restservices/customerseries/score?customer="+user+"&password="+password+"&series="+seriesid+"&score="+intscore;

	    $.ajax(uri, { 
	        type: "put", 
	        success: function(response) {
	        	alert("Your score for this series has been adjusted!");
	            $("#response").text("Customer saved!");
	        },
	        error: function(response) {
	            $("#response").text("Could not update customer!");
	        }
	    }); }else{
		    alert("A score needs to be between 1 and 10.");
	    }
	});
</script>
<script>
loadSeries()
</script>


</body>
</html>
